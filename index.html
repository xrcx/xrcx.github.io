<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="做自己爱做的事，爱自己在做的事！贵在坚持~">
<meta property="og:type" content="website">
<meta property="og:title" content="学无止境">
<meta property="og:url" content="https://xrcx.github.io/index.html">
<meta property="og:site_name" content="学无止境">
<meta property="og:description" content="做自己爱做的事，爱自己在做的事！贵在坚持~">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="学无止境">
<meta name="twitter:description" content="做自己爱做的事，爱自己在做的事！贵在坚持~">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://xrcx.github.io/"/>





  <title>学无止境</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">学无止境</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学无止境</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/09/Day25-伊索寓言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/09/Day25-伊索寓言/" itemprop="url">Day 25（伊索寓言）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-09T23:00:00+08:00">
                2017-11-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/英语/" itemprop="url" rel="index">
                    <span itemprop="name">英语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><h2 id="单词"><a href="#单词" class="headerlink" title="单词"></a>单词</h2><ol>
<li><p>trick</p>
<ul>
<li>欺骗,哄骗(动词)<ul>
<li>…so he decided to get his food by tricking the other animals…</li>
</ul>
</li>
<li>诡计,恶作剧(名词)<ul>
<li>He didn’t really lose his wallet - that’s just a trick.</li>
</ul>
</li>
</ul>
</li>
<li><p>master</p>
<ul>
<li>主人,n  <ul>
<li>… and fast enough to carry his master out of danger.. </li>
</ul>
</li>
<li>硕士,n<ul>
<li>I will begin my master`s degree one year later.</li>
</ul>
</li>
<li>掌握,v<ul>
<li>The skills needed to master a new language.</li>
</ul>
</li>
</ul>
</li>
<li><p>offer</p>
<ul>
<li>报价、提议<ul>
<li>When people make you good offers, think about their reasons.</li>
<li>make 给</li>
</ul>
</li>
<li>录取通知书<ul>
<li>Have you received the offer from Tsinghua University？</li>
</ul>
</li>
<li>优惠<ul>
<li>There so many special offers in Baicizhan Supermarket on on November 11th. </li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="短语"><a href="#短语" class="headerlink" title="短语"></a>短语</h2><ul>
<li>be publicly known    被众人所知，公开<ul>
<li>Jay Chou is a publicly known figure. </li>
</ul>
</li>
<li>ask about something   表示询问某事</li>
<li>go on  继续，持续</li>
<li>return too 回到</li>
<li>lie down      躺下</li>
<li>pretend to        假装</li>
<li>make sure         确保</li>
<li>one by one        一个接一个</li>
<li>come in       进来</li>
<li>a lack of         缺乏</li>
<li>plenty of         足够的</li>
<li>look after        照顾</li>
<li>once more         再一次</li>
<li>ride off 骑马而去</li>
<li>on foot 走路</li>
<li>turn somebody from … into … ,把某人从…变成…</li>
<li>in a moment 立刻</li>
<li>come up 出现</li>
<li>lead to 导致</li>
</ul>
<h2 id="格言"><a href="#格言" class="headerlink" title="格言"></a>格言</h2><ul>
<li>A wise person learns from the misfortunes of others.    智者从别人的不幸中吸取教训。</li>
<li>Sometimes those who claim to be helping you are actually using you.   有时那些自称帮忙的人实际是想利用你。</li>
<li>If you neglect someone now, don’t depend on them helping you later.</li>
<li>What is most truly valuable is often undervalued. 真正有价值的事物往往会被低估。</li>
</ul>
<h2 id="句子"><a href="#句子" class="headerlink" title="句子"></a>句子</h2><ol>
<li>When it was too late, he said to himself, “How wrong I am! I hated these feet which would have saved me, but loved these horns which have led to my death.<ul>
<li>How + 形容词 + 主语 + be动词 感叹句</li>
<li>would have + 动词的分词,表示过去的事“本应…，事实上并没有…”</li>
<li>I would have done it better. 我本来可以做得更好的。（事实上我没有做得很好）</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/08/Day24-伊索寓言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/08/Day24-伊索寓言/" itemprop="url">Day 24（伊索寓言）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-08T23:00:00+08:00">
                2017-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/英语/" itemprop="url" rel="index">
                    <span itemprop="name">英语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><h2 id="单词"><a href="#单词" class="headerlink" title="单词"></a>单词</h2><ol>
<li><p>scorpion</p>
<ul>
<li>蝎子</li>
<li>Scorpio 天蝎座</li>
</ul>
</li>
<li><p>trip</p>
<ul>
<li>绊倒  <ul>
<li>…, he tripped and fell into the water</li>
</ul>
</li>
<li>旅行，出行，作名词<ul>
<li>They went on a trip to America.</li>
</ul>
</li>
</ul>
</li>
<li><p>offer</p>
<ul>
<li>报价、提议<ul>
<li>When people make you good offers, think about their reasons.</li>
<li>make 给</li>
</ul>
</li>
<li>录取通知书<ul>
<li>Have you received the offer from Tsinghua University？</li>
</ul>
</li>
<li>优惠<ul>
<li>There so many special offers in Baicizhan Supermarket on on November 11th. </li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="短语"><a href="#短语" class="headerlink" title="短语"></a>短语</h2><ul>
<li>find sth. extremely unpleasant    认为…非常非常地让人不愉快</li>
<li>go on for… 持续了…（时间）,eg:go on for some time   持续了一段时间</li>
<li>get used to sth 习惯于某事   ,也可以用<code>be used to</code>,而<code>used to do</code> 是以前常常做某事,be / get used to后面是接something，所以如果是动词的话要用ing形式。而used to do something是接动词原形</li>
<li>put off 推迟</li>
<li>be supposed to do 理应做某事</li>
<li>no longer 不再</li>
<li>allow sb. to do 允许某人做…</li>
<li>fall into the water 掉进水里</li>
<li>on purpose 故意地</li>
<li>see through 看穿</li>
<li>instead of 而不是</li>
<li>play the fool 干蠢事,装疯卖傻，做傻事<ul>
<li>The donkey, again playing the fool, fell down on purpose when he reached the river.</li>
</ul>
</li>
<li>can’t help doing sth. 忍不住做某事<ul>
<li>help 避免,作动词</li>
<li>I can’t help it, it’s in my nature.</li>
</ul>
</li>
</ul>
<h2 id="格言"><a href="#格言" class="headerlink" title="格言"></a>格言</h2><ul>
<li>With time, one can get used to anything.  久入芝兰之室而不闻其香，久入鲍鱼之肆而不闻其臭。</li>
<li>The same plan will not suit all situations.   同样的计划不会适用于所有的情况。</li>
<li>Don’t expect people to change.    本性难移。</li>
<li>When people make you good offers, think about their reasons.  事出无常必有妖。(当人们给你报好价的时候，想一想原因是什么)</li>
</ul>
<h2 id="句子"><a href="#句子" class="headerlink" title="句子"></a>句子</h2><ol>
<li>When no-one wanted to buy it, he tried to sell it by claiming that the statue would make whoever owned it very rich.<ul>
<li>claim 一般都是对说话的那个人持有一定的否定和怀疑态度哦，慎用！ </li>
<li>make whoever owned it very rich,其中“make somebody very rich”表示让某人变得很有钱，whoever owned it就是搭配中somebody，表示“拥有它的任何人”。</li>
<li>own 拥有 ，而不是“自己的”</li>
</ul>
</li>
</ol>
<h2 id="疑问解答"><a href="#疑问解答" class="headerlink" title="疑问解答"></a>疑问解答</h2><ol>
<li><p>There was then much less weight on the donkey(驴)’s back because the water had melted(溶解) the salt.<br> then有几个主要的意思：</p>
<ul>
<li>当时，那时；到那时</li>
<li>然后，接着，后来；</li>
<li>那么，因此<br>这里的then可以理解为上面三个任意一个的意思（但翻译出来其实可以忽略它），去掉Then也不影响句子的理解，这里用上，会更强调句子的因果性，以及时间感（驴一踏进水里，背上就轻了许多）~</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/Day23-伊索寓言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/Day23-伊索寓言/" itemprop="url">伊索寓言（Day 23）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T23:00:00+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/英语/" itemprop="url" rel="index">
                    <span itemprop="name">英语</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><h2 id="单词"><a href="#单词" class="headerlink" title="单词"></a>单词</h2><ol>
<li><p>raven</p>
</li>
<li><p>shoot</p>
<ul>
<li>射击，射杀   <ul>
<li>Some boatmen, sailing by, saw her and shot her.(过去分词：shot)</li>
</ul>
</li>
<li>拍摄    <ul>
<li>You Shoot, I Shoot,《买凶拍人》讲述了一个杀手和导演之间的故事</li>
</ul>
</li>
</ul>
</li>
<li><p>swallow</p>
<ul>
<li>燕子<ul>
<li>…he argued with the small, brown-winged swallow…</li>
</ul>
</li>
<li>吞咽,动词<ul>
<li>He swallowed the pills at a time. 他一次性把药都吞了。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="短语"><a href="#短语" class="headerlink" title="短语"></a>短语</h2><ul>
<li>kept doing something   保持一直做某事</li>
<li>wave something back and forth 来回挥动</li>
<li>be strong enough to do something  足够强大做某事</li>
<li>protect somebody from something 保护某人免受于</li>
<li>want somebody for something 为了某事而需要某人</li>
<li>in the middle of 在…中间</li>
<li>create problems 制造麻烦</li>
<li>be worried about 担心…</li>
<li>after all 毕竟</li>
<li>back and forth 来回地</li>
<li>make fun of 取笑</li>
<li>on the other hand 另一方面</li>
<li>weigh somebody down 使某人不堪负重</li>
<li>let go of 放开</li>
<li>by far 最、显然 （一定要与so far区分哦，so far 意思是“到目前为止”）</li>
<li>make a loud noise 发出很大的噪音</li>
<li>get free 获得自由</li>
</ul>
<h2 id="格言"><a href="#格言" class="headerlink" title="格言"></a>格言</h2><ul>
<li>Those who try too hard to be clever often create bigger problems for themselves.<br>聪明反被聪明误。</li>
<li>Danger sometimes comes from a place we don’t expect.<br>危险有的时候来自不可预料的地方。</li>
<li>We travel furthest and highest when we let go of our pride.<br>放下骄傲的我们能到更高更远的地方。</li>
<li>Don’t choose your rulers for their attractiveness.<br>不要选华而不实的领导。</li>
<li>We have great powers that come to us only in an emergency.<br>关键时刻往往有无穷爆发力。</li>
</ul>
<h2 id="句子"><a href="#句子" class="headerlink" title="句子"></a>句子</h2><ol>
<li><p>A woman had two servants/ whom she used to call to work as soon as she heard the rooster cry in the morning.</p>
<ul>
<li>used to   过去经常做某事</li>
<li>call to work 叫来工作 </li>
<li>as soon as   一…就…<ul>
<li>I’ll come over to your place as soon as I can.我会尽快到你这里来。</li>
</ul>
</li>
<li>she heard the rooster cry    听到公鸡叫 </li>
</ul>
</li>
<li><p>A deer(鹿), who could only see out of one eye, used to eat as near to the sea as she possibly could, to be safe.</p>
<ul>
<li>有一只鹿只有一只眼睛可以看见，为安全起见（to be safe），她每次觅食时都尽可能的靠近海。</li>
<li>see out of one eye  只有一只眼睛能看见</li>
<li>as … as somebody possibly could   尽某人可能的</li>
</ul>
</li>
<li><p>After all, this beach which I came to for safety is much more dangerous. </p>
<ul>
<li>我为了安全而到的沙滩才是更危险的</li>
<li>after all 毕竟</li>
</ul>
</li>
<li><p>You, on the other hand, can only flap those beautiful feathers of yours down there on the ground, just like a chicken.</p>
<ul>
<li>on the other hand 另一方面，可以用在句首或者插在句中。经常用到的一种搭配是on the one hand…, on the other hand…“一方面……，另一方面……”，用来说处于两个不同侧面之下的事情。</li>
<li>down there on the ground，在地面上，down在这里就是形容“下面，地处”，ground指的是“地面”</li>
</ul>
</li>
</ol>
<h2 id="疑问解答"><a href="#疑问解答" class="headerlink" title="疑问解答"></a>疑问解答</h2><ol>
<li><p>Those who try too hard to be clever</p>
<ul>
<li>太想显示出聪明，hard 努力的</li>
</ul>
</li>
<li><p>A deer(鹿), who could only see out of one eye, used to eat as near to the sea as she possibly could, to be safe.</p>
<ul>
<li>to be safe是目的状语</li>
<li>to do Sth，常常可以见到是表示“目的”</li>
</ul>
</li>
<li><p>After all, this beach which I came to for safety  is much more dangerous.</p>
<ul>
<li>come 多作为不及物动词（vi），除了极少数用作及物动词，所以后面接名词要用to连接，这里是come to this beach</li>
<li>for safety表示目的，for+名词 也有“为了。。。”的意思，比如for fun</li>
</ul>
</li>
<li><p>can rise/ on these wings high up into the sky</p>
<ul>
<li>rise是不及物动词，“上升”的意思，怎样上升呢，on these wings，通过这对翅膀上升（也就是飞）</li>
<li>high up into the sky做状语，表示飞起来之后的状态：高高的在空中，这句话是“可以扶摇直上，飞上天”的意思</li>
</ul>
</li>
<li><p>can only flap(拍打) those beautiful feathers(羽毛) of yours down there on the ground</p>
<ul>
<li>feathers of yours，你的翅膀</li>
<li>flap…down ，把…拍下</li>
<li>on the ground ，拍在地面上</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/异步单元测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/异步单元测试/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="异步方法单元测试"><a href="#异步方法单元测试" class="headerlink" title="异步方法单元测试"></a>异步方法单元测试</h1><h2 id="问题描述与思路"><a href="#问题描述与思路" class="headerlink" title="问题描述与思路"></a>问题描述与思路</h2><p>问题 : 测试方法跑完了的时候，被测代码可能还没跑完</p>
<p>思路 : </p>
<pre><code>- 异步代码执行完了再执行assert操作
- 二是将异步变成同步
</code></pre><h3 id="普通异步方法"><a href="#普通异步方法" class="headerlink" title="普通异步方法"></a>普通异步方法</h3><h4 id="方法一-等待异步代码执行完毕：使用CountDownLatch"><a href="#方法一-等待异步代码执行完毕：使用CountDownLatch" class="headerlink" title="方法一:等待异步代码执行完毕：使用CountDownLatch"></a>方法一:等待异步代码执行完毕：使用CountDownLatch</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>类似于倒序计数，刚开始设定了一个数字，每次countDown()这个数字减一，await()方法会一直等待，直到这个数字为0。</p>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><ul>
<li>countDown() </li>
<li><p>await()  -   阻塞当前线程，直到countDown()被调用了一定的次数，这个次数就是在创建这个CountDownLatch对象时，传入的构造参数。</p>
<p>  其中 await() 还有一个重载方法，可以用来指定你要等待多久</p>
<blockquote>
<p>   // 等待2秒钟，如果2秒以后，计数是0了，则返回True，否则返回False。</p>
<p>   latch.await(2, TimeUnit.SECONDS);</p>
</blockquote>
</li>
</ul>
<p><strong> 例子 </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">3</span>);</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// 下面这行代码会让当前线程一直停在这里</span></div><div class="line"><span class="comment">// 直到latch.countDown()被调用了3次（一般是在其它线程）</span></div><div class="line">latch.await();</div></pre></td></tr></table></figure>
<h5 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h5><ul>
<li><p>必需有Callback</p>
<p>  countDown()必须可以在测试代码里面写，换句话说，必需有Callback。如果被测的异步方法（比如上面的loadRepos())不是通过Callback的方式来通知结果，而是通过post EventBus的Event来通知外面方法运行的结果，那CountDownLatch是无法解决这个异步方法的单元测试问题的。</p>
</li>
<li><p>写起来麻烦</p>
<p>  创建对象、调用countDown()、调用await()都必须手动写，而且还没有通用性</p>
</li>
</ul>
<h4 id="方法二-将异步变成同步"><a href="#方法二-将异步变成同步" class="headerlink" title="方法二:将异步变成同步"></a>方法二:将异步变成同步</h4><p>依赖注入</p>
<h5 id="直接new-Thread的情况"><a href="#直接new-Thread的情况" class="headerlink" title="直接new Thread的情况"></a>直接new Thread的情况</h5><p>呃，如果你直接在正式代码里面new Thread()来做异步，那么你的代码是没有办法变成同步的，换成Executor这种方式来做吧。</p>
<h5 id="Executor或ExecutorService的情况"><a href="#Executor或ExecutorService的情况" class="headerlink" title="Executor或ExecutorService的情况"></a>Executor或ExecutorService的情况</h5><p>如果你的代码是通过Executor或ExecutorService来做异步的，那在测试中把异步变成同步的做法，跟在测试中使用mock对象的方法是一样的，那就是使用依赖注入。在测试代码里面将同步的Executor注入进去。创建同步的Executor对象很简单，以下就是一个同步的Executor：</p>
<p>Executor executor = new Executor() {<br>    @Override<br>    public void execute(Runnable command) {<br>        command.run();<br>    }<br>};<br>当然，你可以使用一个辅助的factory方法来做这件事情。至于怎么样将这个同步的Executor在测试里面替换掉真实异步的那个Executor，就是依赖注入的问题了。具体的做法请参见系列第5篇：依赖注入，将mock方便的用起来，如果你使用了Dagger2的话，请看第六篇：使用dagger2来做依赖注入，以及在单元测试中的应用。</p>
<h5 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h5><p>笔者建议是不要使用AsyncTask，这个东西有很多问题，其中之一是它的行为是很难预测的，之二是如果你在Activity里面使用的话，其实这部分代码往往是不应该放在Activity里面的。<br>不过，如果你实在需要使用AsyncTask，同时又想对这些代码作单元测试的话，建议是使用 AsyncTask#executeOnExecutor()而不是直接使用AsyncTask#execute()，然后通过依赖注入的方式，在测试环境下将同步的Executor注入进去。</p>
<h3 id="Rxjava-单元测试"><a href="#Rxjava-单元测试" class="headerlink" title="Rxjava 单元测试"></a>Rxjava 单元测试</h3><ul>
<li>Rx 默认是单线程的,除非你明确的指定线程，否则所有 onNext/onError/onCompleted 以及各个操作函数的调用都是在同一个线程中完成的</li>
<li>subscribeOn 和 observeOn 分别用来控制 subscription 的调用线程和 接受事件通知（Observer 的 onNext/onError/onCompleted 函数）的线程</li>
<li>有些 Observable 内部会使用它们自己创建的线程。例如 Observable.interval 就是异步的。这种情况下，无需指定新的线程。</li>
</ul>
<h4 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h4><p>普通写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRxjava</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    List&lt;String&gt; WORDS = Arrays.asList(</div><div class="line">        <span class="string">"the"</span>,</div><div class="line">        <span class="string">"quick"</span>,</div><div class="line">        <span class="string">"brown"</span>,</div><div class="line">        <span class="string">"fox"</span>,</div><div class="line">        <span class="string">"jumped"</span>,</div><div class="line">        <span class="string">"over"</span>,</div><div class="line">        <span class="string">"the"</span>,</div><div class="line">        <span class="string">"lazy"</span>,</div><div class="line">        <span class="string">"dog"</span></div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="comment">// 1.用 TestObserver 测试 Rxjava</span></div><div class="line">    TestObserver&lt;String&gt; testObserver = <span class="keyword">new</span> TestObserver&lt;&gt;();</div><div class="line">    Observable&lt;String&gt; observable = Observable.fromIterable(WORDS)</div><div class="line">                   .zipWith(Observable.range(<span class="number">1</span>, Integer.MAX_VALUE), (string, index) -&gt; String.format(<span class="string">"%2d. %s"</span>, index, string));</div><div class="line"></div><div class="line">    observable.subscribeOn(Schedulers.computation())</div><div class="line">              .subscribe(testObserver);</div><div class="line"></div><div class="line">    <span class="comment">// 2. 等待 testObserver 收到返回</span></div><div class="line">    testObserver.awaitTerminalEvent();</div><div class="line"></div><div class="line">    <span class="comment">// 3. 要验证的内容</span></div><div class="line">    testObserver.assertComplete();</div><div class="line">    testObserver.assertNoErrors();</div><div class="line">    assertThat(testObserver.values()).contains(<span class="string">" 4. fox"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>简单写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRxjavaSimpleWay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    List&lt;String&gt; WORDS = Arrays.asList(</div><div class="line">            <span class="string">"the"</span>,</div><div class="line">            <span class="string">"quick"</span>,</div><div class="line">            <span class="string">"brown"</span>,</div><div class="line">            <span class="string">"fox"</span>,</div><div class="line">            <span class="string">"jumped"</span>,</div><div class="line">            <span class="string">"over"</span>,</div><div class="line">            <span class="string">"the"</span>,</div><div class="line">            <span class="string">"lazy"</span>,</div><div class="line">            <span class="string">"dog"</span></div><div class="line">    );</div><div class="line"></div><div class="line">    Observable.fromIterable(WORDS)</div><div class="line">              .zipWith(Observable.range(<span class="number">1</span>, Integer.MAX_VALUE), (string, index) -&gt; String.format(<span class="string">"%2d. %s"</span>, index, string))</div><div class="line">              .subscribeOn(Schedulers.computation())</div><div class="line">              .test()</div><div class="line">              .await()</div><div class="line">              .assertComplete()</div><div class="line">              .assertNoErrors()</div><div class="line">              .assertValueAt(<span class="number">4</span>, value -&gt; value.equals(<span class="string">" 5. jumped"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="测试异常"><a href="#测试异常" class="headerlink" title="测试异常"></a>测试异常</h4><p>测试目标代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">Observable&lt;String&gt; <span class="title">confirmation</span><span class="params">()</span> </span>&#123;</div><div class="line">    Observable&lt;String&gt; delayBeforeCompletion = Observable.&lt;String&gt;empty()</div><div class="line">                                                    .delay(<span class="number">200</span>, MILLISECONDS);</div><div class="line">    <span class="keyword">return</span> Observable.just(<span class="string">"a"</span>)</div><div class="line">                     .delay(<span class="number">100</span>, MILLISECONDS)</div><div class="line">                     .concatWith(delayBeforeCompletion);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTimeOut</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line"></div><div class="line">    confirmation().timeout(<span class="number">110</span>, MILLISECONDS)</div><div class="line">                  .test()</div><div class="line">                  .await()</div><div class="line">                  .assertValue(<span class="string">"a"</span>)</div><div class="line">                  .assertError(TimeoutException.class);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="TestScheduler"><a href="#TestScheduler" class="headerlink" title="TestScheduler"></a>TestScheduler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.interval(<span class="number">1</span>, TimeUnit.SECONDS)</div><div class="line">          .take(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p>Observable 发射一个数据流，需要 5秒 来发射完所有的数据。如果我们使用自动化测试这个代码，则是不是意味着测试代码也要执行 5秒，如果我们有成千上万个这样的测试，测试将消耗很多时间去完成。<br>解决方案：实际操作中，虽然无法加速系统时钟，但是可以加速一个虚拟的时钟。在 Rx 设计中，考虑到只在 scheduler 中使用时间相关的操作。这样可以用一个虚拟的 TestScheduler 来替代真实的 Scheduler。</p>
<h5 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h5><ul>
<li>advanceTimeTo：把 TestScheduler 中的时钟前进指定的时间刻度</li>
<li>advanceTimeBy：在当前时间基础上前进多少</li>
<li>triggerActions：triggerActions 不会修改时间。只是用来执行当前可以调度的任务</li>
</ul>
<h5 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h5><h6 id="advanceTime-例子"><a href="#advanceTime-例子" class="headerlink" title="advanceTime 例子"></a>advanceTime 例子</h6><p>测试目标代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">     <span class="function"><span class="keyword">public</span> Observable&lt;String&gt; <span class="title">createData</span><span class="params">(Scheduler scheduler)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; WORDS = Arrays.asList(</div><div class="line">                <span class="string">"the"</span>,</div><div class="line">                <span class="string">"quick"</span>,</div><div class="line">                <span class="string">"brown"</span>,</div><div class="line">                <span class="string">"fox"</span>,</div><div class="line">                <span class="string">"jumped"</span>,</div><div class="line">                <span class="string">"over"</span>,</div><div class="line">                <span class="string">"the"</span>,</div><div class="line">                <span class="string">"lazy"</span>,</div><div class="line">                <span class="string">"dog"</span></div><div class="line">        );</div><div class="line"></div><div class="line">        <span class="keyword">return</span> Observable.fromIterable(WORDS)</div><div class="line">                         .zipWith(Observable.interval(<span class="number">1</span>, SECONDS, scheduler) , (string, index) -&gt; String.format(<span class="string">"%2d. %s"</span>, index, string));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试用例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScheduler</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    Scheduler scheduler = Schedulers.newThread();</div><div class="line"></div><div class="line">    <span class="keyword">new</span> CommonExample().createData(scheduler)</div><div class="line">                       .test()</div><div class="line">                       .await()</div><div class="line">                       .assertNoErrors()</div><div class="line">                       .assertComplete()</div><div class="line">                       .assertValueAt(<span class="number">8</span>, value -&gt; value.equals(<span class="string">" 8. dog"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSchedulerByAdvanceTime</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">       Scheduler scheduler = <span class="keyword">new</span> TestScheduler();</div><div class="line"></div><div class="line">       CommonExample commonExample = <span class="keyword">new</span> CommonExample();</div><div class="line">       TestObserver&lt;String&gt; observer = commonExample.createData(scheduler).test();</div><div class="line"></div><div class="line">       observer.assertNoValues()</div><div class="line">               .assertNotComplete();</div><div class="line"></div><div class="line">       ((TestScheduler) scheduler).advanceTimeBy(<span class="number">1</span>, SECONDS);</div><div class="line"></div><div class="line">       observer.assertNoErrors()</div><div class="line">               .assertValueCount(<span class="number">1</span>)</div><div class="line">               .assertValues(<span class="string">" 0. the"</span>);</div><div class="line"></div><div class="line">       ((TestScheduler) scheduler).advanceTimeTo(<span class="number">9</span>, SECONDS);</div><div class="line"></div><div class="line">       observer.assertComplete()</div><div class="line">               .assertNoErrors()</div><div class="line">               .assertValueCount(<span class="number">9</span>)</div><div class="line">               .assertValueAt(<span class="number">8</span>, value -&gt; value.equals(<span class="string">" 8. dog"</span>));</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h6 id="triggerActions-例子"><a href="#triggerActions-例子" class="headerlink" title="triggerActions 例子"></a>triggerActions 例子</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTriggerActions</span><span class="params">()</span> </span>&#123;</div><div class="line">    TestScheduler s = <span class="keyword">new</span> TestScheduler();</div><div class="line">    s.createWorker().schedule(() -&gt; System.out.println(<span class="string">"createWorker  Immediate"</span>));</div><div class="line">    s.createWorker().schedule(() -&gt; System.out.println(<span class="string">"createWorker    20s"</span>), <span class="number">20</span>, TimeUnit.SECONDS);</div><div class="line">    s.triggerActions();</div><div class="line">    System.out.println(<span class="string">"Virtual time: "</span> + s.now(TimeUnit.SECONDS));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="配合模拟使用"><a href="#配合模拟使用" class="headerlink" title="配合模拟使用"></a>配合模拟使用</h4><p>测试目标代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Single&lt;List&lt;UserStats&gt;&gt; loadUsers() &#123;</div><div class="line">       <span class="keyword">return</span> service.getTopUsers()</div><div class="line">               .flattenAsObservable(UserResponse::items)</div><div class="line">               .take(<span class="number">5</span>)</div><div class="line">               .flatMapSingle(<span class="keyword">this</span>::loadUserStats)</div><div class="line">               .toList();</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">private</span> Single&lt;UserStats&gt; <span class="title">loadUserStats</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> service.getBadges(user.id())</div><div class="line">               .subscribeOn(Schedulers.io())</div><div class="line">               .map(BadgeResponse::items)</div><div class="line">               .map(badges -&gt; UserStats.create(user, badges));</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>loadUsers 返回数据顺序不一定，根据 userid 获取 loadUserStats 返回的顺序也不确定，所以测试用例要考虑多种情况<br>测试用例代码：</p>
<ul>
<li>以下测试用例结果不固定</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubscribe</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">     when(stackOverflowService.getTopUsers()).thenReturn(</div><div class="line">             just(UserResponse.create(</div><div class="line">                     User.create(<span class="number">2</span>, <span class="number">100</span>, <span class="string">"user 2"</span>),</div><div class="line">                     User.create(<span class="number">1</span>, <span class="number">100</span>, <span class="string">"user 1"</span>)</div><div class="line">             ))</div><div class="line">     );</div><div class="line">     when(stackOverflowService.getBadges(anyInt())).thenReturn(</div><div class="line">             just(BadgeResponse.create(Badge.create(<span class="string">"badge"</span>))));</div><div class="line"></div><div class="line"></div><div class="line">     userService.loadUsers()</div><div class="line">             .test()</div><div class="line">             .await()</div><div class="line">             .assertNoErrors()</div><div class="line">             .assertValue(l -&gt; l.size() == <span class="number">2</span>)</div><div class="line">             .assertValue(l -&gt;</div><div class="line">                     Observable.fromIterable(l)</div><div class="line">                             .map(UserStats::id)</div><div class="line">                             .toList()</div><div class="line">                             .blockingGet()</div><div class="line">                             .equals(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>)));</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>这种测试用例可能出现两种情况，顺序可能 user1，user2，也有可能 user2，user1，导致测试结果不准确</p>
<ul>
<li>测试用例要尽可能模拟真实情况，多种情况, 确保测试用的结果是确定的，而不是多变的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubscribe</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        when(stackOverflowService.getTopUsers())</div><div class="line">                .thenReturn(just(UserResponse.create(</div><div class="line">                        User.create(<span class="number">1</span>, <span class="number">100</span>, <span class="string">"user 1"</span>),</div><div class="line">                        User.create(<span class="number">2</span>, <span class="number">100</span>, <span class="string">"user 2"</span>)</div><div class="line">                )));</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">1</span>))).thenReturn(</div><div class="line">                just(BadgeResponse.create(Badge.create(<span class="string">"badge1"</span>)))</div><div class="line">                        .delay(<span class="number">2</span>, TimeUnit.SECONDS));</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">2</span>))).thenReturn(</div><div class="line">                just(BadgeResponse.create(Badge.create(<span class="string">"badge2"</span>)))</div><div class="line">                        .delay(<span class="number">1</span>, TimeUnit.SECONDS));</div><div class="line"></div><div class="line">        userService.loadUsers()</div><div class="line">                .test()</div><div class="line">                .await()</div><div class="line">                .assertNoErrors()</div><div class="line">                .assertValue(l -&gt; </div><div class="line">                        Observable.fromIterable(l)</div><div class="line">                                .map(UserStats::id)</div><div class="line">                                .toList()</div><div class="line">                                .blockingGet()</div><div class="line">                                .equals(Arrays.asList(<span class="number">2</span>, <span class="number">1</span>)));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果想loadUserStats 的顺序按照 loadUsers传入的顺序输出,可以修改源程序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Single&lt;List&lt;UserStats&gt;&gt; loadUsers() &#123;</div><div class="line">        <span class="keyword">return</span> service.getTopUsers()</div><div class="line">                .flattenAsObservable(UserResponse::items)</div><div class="line">                .take(<span class="number">5</span>)</div><div class="line">                .concatMap(<span class="keyword">this</span>::loadUserStats)</div><div class="line">                .toList();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Observable&lt;UserStats&gt; <span class="title">loadUserStats</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> service.getBadges(user.id())</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .map(BadgeResponse::items)</div><div class="line">                .map(badges -&gt; UserStats.create(user, badges))</div><div class="line">                .toObservable();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>测试异常情况</p>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Single&lt;List&lt;UserStats&gt;&gt; loadUsers() &#123;</div><div class="line">        <span class="keyword">return</span> service.getTopUsers()</div><div class="line">                .flattenAsObservable(UserResponse::items)</div><div class="line">                .take(<span class="number">5</span>)</div><div class="line">                .concatMap(<span class="keyword">this</span>::loadUserStats)</div><div class="line">                .retry(<span class="number">1</span>)</div><div class="line">                .toList();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Observable&lt;UserStats&gt; <span class="title">loadUserStats</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> service.getBadges(user.id())</div><div class="line">                .subscribeOn(Schedulers.io())</div><div class="line">                .map(BadgeResponse::items)</div><div class="line">                .map(badges -&gt; UserStats.create(user, badges))</div><div class="line">                .toObservable();</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testErrorOnBadge</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        when(stackOverflowService.getTopUsers()).thenReturn(</div><div class="line">                just(UserResponse.create(</div><div class="line">                        User.create(<span class="number">1</span>, <span class="number">200</span>, <span class="string">"user 1"</span>),</div><div class="line">                        User.create(<span class="number">2</span>, <span class="number">100</span>, <span class="string">"user 2"</span>)</div><div class="line">                ))</div><div class="line">        );</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">1</span>)))</div><div class="line">                .thenThrow(<span class="keyword">new</span> RuntimeException(<span class="string">":("</span>))</div><div class="line">                .thenReturn(</div><div class="line">                        just(BadgeResponse.create(Badge.create(<span class="string">"badge1"</span>)))</div><div class="line">                );</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">2</span>))).thenReturn(</div><div class="line">                just(BadgeResponse.create(Badge.create(<span class="string">"badge2"</span>)))</div><div class="line">        );</div><div class="line"></div><div class="line">        userService.loadUsers()</div><div class="line">                .test()</div><div class="line">                .await()</div><div class="line">                .assertNoErrors()</div><div class="line">                .assertValue(l -&gt;</div><div class="line">                        Observable.fromIterable(l)</div><div class="line">                                .map(UserStats::id)</div><div class="line">                                .toList()</div><div class="line">                                .blockingGet()</div><div class="line">                                .equals(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>)));</div><div class="line">&#125;</div><div class="line"></div><div class="line"> <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testErrorOnTopUsers</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        when(stackOverflowService.getTopUsers())</div><div class="line">                .thenReturn(Single.fromCallable(<span class="keyword">new</span> Callable&lt;UserResponse&gt;() &#123;</div><div class="line">                    <span class="keyword">private</span> <span class="keyword">boolean</span> firstEmitted;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> UserResponse <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (!firstEmitted) &#123;</div><div class="line">                            firstEmitted = <span class="keyword">true</span>;</div><div class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">":("</span>);</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="keyword">return</span> UserResponse.create(</div><div class="line">                                    User.create(<span class="number">1</span>, <span class="number">200</span>, <span class="string">"user 1"</span>),</div><div class="line">                                    User.create(<span class="number">2</span>, <span class="number">100</span>, <span class="string">"user 2"</span>)</div><div class="line">                            );</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;));</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">1</span>))).thenReturn(</div><div class="line">                just(BadgeResponse.create(Badge.create(<span class="string">"badge1"</span>)))</div><div class="line">        );</div><div class="line">        when(stackOverflowService.getBadges(eq(<span class="number">2</span>))).thenReturn(</div><div class="line">                just(BadgeResponse.create(Badge.create(<span class="string">"badge2"</span>)))</div><div class="line">        );</div><div class="line"></div><div class="line">        userService.loadUsers()</div><div class="line">                .test()</div><div class="line">                .await()</div><div class="line">                .assertNoErrors()</div><div class="line">                .assertValue(l -&gt;</div><div class="line">                        Observable.fromIterable(l)</div><div class="line">                                .map(UserStats::id)</div><div class="line">                                .toList()</div><div class="line">                                .blockingGet()</div><div class="line">                                .equals(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>)));</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><a href="http://www.infoq.com/cn/articles/Testing-RxJava2" target="_blank" rel="external">http://www.infoq.com/cn/articles/Testing-RxJava2</a><br><a href="http://chriszou.com/2016/08/06/android-unit-testing-async.html" target="_blank" rel="external">http://chriszou.com/2016/08/06/android-unit-testing-async.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/反编译/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/反编译/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ApkTools</p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://ibotpeaches.github.io/Apktool/" target="_blank" rel="external">https://ibotpeaches.github.io/Apktool/</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a href="https://ibotpeaches.github.io/Apktool/install/" target="_blank" rel="external">https://ibotpeaches.github.io/Apktool/install/</a></p>
<p>s</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/temp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/temp/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> wubo笔记 <a href="http://blog.vichamp.com/" target="_blank" rel="external">http://blog.vichamp.com/</a></p>
<p> powershell</p>
<p> 邮件插件 markdown in email</p>
<p> <a href="https://yq.aliyun.com/articles/8607" target="_blank" rel="external">Hexo</a></p>
<p> ctrl+u</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/Robolectric/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/Robolectric/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Robolectric"><a href="#Robolectric" class="headerlink" title="Robolectric"></a>Robolectric</h1><ul>
<li><a href="">GitHub</a></li>
<li>[官网}()<br>Robolectric 测试框架针对 Android 的组件（包含各种View）进行了统一的 Shadow，使得我们不再依赖模拟器或真机，直接就单元测试就可方便地测试我们的 UI。</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">testCompile <span class="string">"org.robolectric:robolectric:3.3.2"</span></div></pre></td></tr></table></figure>
<p>第一次下载 robolectric 依赖库太慢了，给个解决方案</p>
<h5 id="方案一，单独下载jar，再拷贝"><a href="#方案一，单独下载jar，再拷贝" class="headerlink" title="方案一，单独下载jar，再拷贝"></a>方案一，单独下载jar，再拷贝</h5><ol>
<li>添加配置如下<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">testCompile <span class="string">"org.robolectric:robolectric:3.3.2"</span></div><div class="line">testCompile group: <span class="string">'org.robolectric'</span>, name: <span class="string">'android-all'</span>, version: <span class="string">'7.1.0_r7-robolectric-0'</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>第二句是让gradle从 <a href="https://jcenter.bintray.com" target="_blank" rel="external">https://jcenter.bintray.com</a> 下载 android-all-7.1.0_r7-robolectric-0 依赖库</p>
<ol>
<li>拷贝jar包<br>从jcenter下载的库，保存在 C:\Users{User Name}.gradle\caches\modules-2\files-2.1\目录下。<br>robolectric下载的库放在本地目录 ~/.m2/repository/<br>所以将 C:\Users{User Name}.gradle\caches\modules-2\files-2.1\ 拷贝到 ~/.m2/repository/ 中。<br>即：拷贝C:\Users{User Name}.gradle\caches\modules-2\files-2.1\org.robolectric\android-all\4.1.2_r1-robolectric-0\aecc8ce5119a25fcea1cdf8285469c9d1261a352\android-all-4.1.2_r1-robolectric-0.jar<br>到$user.home.m2\repository\org\robolectric\android-all\4.1.2_r1-robolectric-0\</li>
</ol>
<h5 id="方案二，把oss-sonatype-org改成阿里云maven仓库（推荐）"><a href="#方案二，把oss-sonatype-org改成阿里云maven仓库（推荐）" class="headerlink" title="方案二，把oss.sonatype.org改成阿里云maven仓库（推荐）"></a>方案二，把oss.sonatype.org改成阿里云maven仓库（推荐）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        maven &#123; url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span> &#125;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.2.3'</span></div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        maven &#123; url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span> &#125;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h3><p>app里面有两个Activity：MainActivity和SecondActivity，MainActivity里面有一个TextView，点击一下这个TextView将跳转到SecondActivity。<br>测试目标方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line"></div><div class="line">        TextView textView = (TextView)findViewById(R.id.textView1);  </div><div class="line">        textView.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, SecondActivity.class));  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class) </div><div class="line"><span class="meta">@Config</span>(constants = BuildConfig.class)  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityTest</span> </span>&#123;  </div><div class="line">    <span class="meta">@Test</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMainActivity</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// 创建 MainActivity 的 instanc，启动 Activity，默认会调用Activity的生命周期: onCreate-&gt;onStart-&gt;onResume</span></div><div class="line">        MainActivity mainActivity = Robolectric.setupActivity(MainActivity.class);  </div><div class="line">        <span class="comment">// 触发点击事件</span></div><div class="line">        mainActivity.findViewById(R.id.textView1).performClick();  </div><div class="line"></div><div class="line">        Intent expectedIntent = <span class="keyword">new</span> Intent(mainActivity, SecondActivity.class); </div><div class="line">        <span class="comment">// 获取mainActivity对应的ShadowActivity的instance</span></div><div class="line">        ShadowActivity shadowActivity = Shadows.shadowOf(mainActivity);  </div><div class="line">        <span class="comment">// 借助Shadow类获取启动下一Activity的Intent</span></div><div class="line">        Intent actualIntent = shadowActivity.getNextStartedActivity();  </div><div class="line">        <span class="comment">// 校验Intent的正确性</span></div><div class="line">        Assert.assertEquals(expectedIntent, actualIntent);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>@RunWith(RobolectricTestRunner.class) - 用Robolectric的TestRunner来跑这些test</li>
<li>@Config - 来配置一些东西。</li>
<li>Robolectric.setupActivity 返回的时候，这个Activity已经完成了onCreate、onStart、onResume这几个生命周期的回调了。</li>
</ul>
<h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><h3 id="Config配置"><a href="#Config配置" class="headerlink" title="@Config配置"></a>@Config配置</h3><p>定制Robolectric的运行时的行为。单个测试类或方法配置Robolectric，在方法级别指定的值将覆盖在类级别指定的值。</p>
<h5 id="1-配置SDK版本"><a href="#1-配置SDK版本" class="headerlink" title="1. 配置SDK版本"></a>1. 配置SDK版本</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Config</span>(sdk = Build.VERSION_CODES.JELLY_BEAN)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Config</span>(sdk = Build.VERSION_CODES.KITKAT)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="2-配置Application类"><a href="#2-配置Application类" class="headerlink" title="2. 配置Application类"></a>2. 配置Application类</h5><blockquote>
<p>Robolectric会根据manifest文件配置的Application配置去实例化一个Application类，如果你想在测试用例中重新指定，可以通过下面的方式配置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Config</span>(application = CustomApplication.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Config</span>(application = CustomApplicationOverride.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="3-指定Resource路径"><a href="#3-指定Resource路径" class="headerlink" title="3. 指定Resource路径"></a>3. 指定Resource路径</h5><blockquote>
<p>Robolectric可以让你配置manifest、resource和assets路径，可以通过下面的方式配置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Config</span>(manifest = <span class="string">"some/build/path/AndroidManifest.xml"</span>,</div><div class="line">        assetDir = <span class="string">"some/build/path/assetDir"</span>,</div><div class="line">        resourceDir = <span class="string">"some/build/path/resourceDir"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Config</span>(manifest = <span class="string">"other/build/path/AndroidManifest.xml"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="4-使用第三方Library-Resources"><a href="#4-使用第三方Library-Resources" class="headerlink" title="4. 使用第三方Library Resources"></a>4. 使用第三方Library Resources</h5><blockquote>
<p>当Robolectric测试的时候，会尝试加载所有应用提供的资源，但如果你需要使用第三方库中提供的资源文件，你可能需要做一些特别的配置。不过如果你使用gradle来构建Android应用，这些配置就不需要做了，因为Gradle Plugin会在build的时候自动合并第三方库的资源，但如果你使用的是Maven，那么你需要配置libraries变量</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</div><div class="line"><span class="meta">@Config</span>(libraries = &#123;</div><div class="line">    <span class="string">"build/unpacked-libraries/library1"</span>,</div><div class="line">    <span class="string">"build/unpacked-libraries/library2"</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="5-使用限定的资源文件"><a href="#5-使用限定的资源文件" class="headerlink" title="5. 使用限定的资源文件"></a>5. 使用限定的资源文件</h5><blockquote>
<p>Android会在运行时加载特定的资源文件，如根据设备屏幕加载不同分辨率的图片资源、根据系统语言加载不同的string.xml，在Robolectric测试当中，你也可以进行一个限定，让测试程序加载特定资源.多个限定条件可以用破折号拼接在在一起。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 使用qualifiers加载对应的资源文件</div><div class="line"> *</div><div class="line"> * <span class="doctag">@throws</span> Exception</div><div class="line"> */</div><div class="line"><span class="meta">@Config</span>(qualifiers = <span class="string">"zh-rCN"</span>)</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="keyword">final</span> Context context = RuntimeEnvironment.application;</div><div class="line">    assertThat(context.getString(R.string.app_name), is(<span class="string">"单元测试Demo"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Properties文件"><a href="#Properties文件" class="headerlink" title="Properties文件"></a>Properties文件</h3><p>如果觉得通过注解配置上面的东西麻烦，也可以把以上配置放在一个Properties文件之中，然后通过@Config指定配置文件，比如，首先创建一个配置文件robolectric.properties，然后把robolectric.properties文件放到src/test/resources目录下，运行的时候，会自动加载里面的配置</p>
<pre><code># 放置Robolectric的配置选项:
sdk=21
manifest=some/build/path/AndroidManifest.xml
assetDir=some/build/path/assetDir
resourceDir=some/build/path/resourceDir
</code></pre><h3 id="系统属性配置"><a href="#系统属性配置" class="headerlink" title="系统属性配置"></a>系统属性配置</h3><ul>
<li>robolectric.offline：true代表关闭运行时获取jar包</li>
<li>robolectric.dependency.dir：当处于offline模式的时候，指定运行时的依赖目录</li>
<li>robolectric.dependency.repo.id：设置运行时获取依赖的Maven仓库ID，默认是sonatype</li>
<li>robolectric.dependency.repo.url：设置运行时依赖的Maven仓库地址，默认是<a href="https://oss.sonatype.org/content/groups/public/" target="_blank" rel="external">https://oss.sonatype.org/content/groups/public/</a></li>
<li>robolectric.logging.enabled：设置是否打开调试开关</li>
</ul>
<p>以上设置可以通过Gradle进行配置，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    testOptions &#123;</div><div class="line">        unitTests.all &#123;</div><div class="line">            systemProperty <span class="string">'robolectric.dependency.repo.url'</span>, <span class="string">'https://local-mirror/repo'</span></div><div class="line">            systemProperty <span class="string">'robolectric.dependency.repo.id'</span>, <span class="string">'local'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用大纲"><a href="#使用大纲" class="headerlink" title="使用大纲"></a>使用大纲</h2><ul>
<li>Robolectric.buildActivity() - 可以测试生命周期</li>
<li>​</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>Robolectric.buildActivity()</td>
<td>初始化的Activity</td>
<td>Robolectric.buildActivity(MyAwesomeActivity.class).create().start().get()</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="详情"><a href="#详情" class="headerlink" title="详情"></a>详情</h2><h3 id="Robolectric-buildActivity"><a href="#Robolectric-buildActivity" class="headerlink" title="Robolectric.buildActivity()"></a>Robolectric.buildActivity()</h3><ul>
<li><p>基本用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ActivityController controller = Robolectric.buildActivity(MyAwesomeActivity.class).create().start();</div><div class="line">Activity activity = controller.get();</div><div class="line"><span class="comment">// assert that something hasn't happened</span></div><div class="line">activityController.resume();</div><div class="line"><span class="comment">// assert it happened!</span></div></pre></td></tr></table></figure>
</li>
<li><p>测试完整的创建生命周期</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Activity activity = Robolectric.buildActivity(MyAwesomeActivity.class).create().start().resume().visible().get();</div></pre></td></tr></table></figure>
</li>
<li><p>用Intent 启动 Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</div><div class="line">Activity activity = Robolectric.buildActivity(MyAwesomeActivity.class).withIntent(intent).create().get();</div></pre></td></tr></table></figure>
</li>
<li><p>恢复保存的实例状态</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Bundle savedInstanceState = <span class="keyword">new</span> Bundle();</div><div class="line">Activity activity = Robolectric.buildActivity(MyAwesomeActivity.class)</div><div class="line">                               .create()</div><div class="line">                               .restoreInstanceState(savedInstanceState)</div><div class="line">                               .get();</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Robolectric-setupActivity"><a href="#Robolectric-setupActivity" class="headerlink" title="Robolectric.setupActivity()"></a>Robolectric.setupActivity()</h3><p>创建 Activity 的instance，当Robolectric.setupActivity返回的时候，这个Activity已经完成了onCreate、onStart、onResume这几个生命周期的回调了。</p>
<h3 id="performClick-模拟用户的点击"><a href="#performClick-模拟用户的点击" class="headerlink" title="performClick() 模拟用户的点击"></a>performClick() 模拟用户的点击</h3><blockquote>
<p>使用clickOn需要在buildActivity后调用visible方法，否则会得到一个错误。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">LoginActivity activity = Robolectric.buildActivity(LoginActivity.class).create().visible().get();</div><div class="line">activity.findViewById(R.id.textView1).performClick();</div></pre></td></tr></table></figure>
<h3 id="getNextStartedActivity-取得最近启动的Activity"><a href="#getNextStartedActivity-取得最近启动的Activity" class="headerlink" title="getNextStartedActivity() - 取得最近启动的Activity"></a>getNextStartedActivity() - 取得最近启动的Activity</h3><p><a href="http://blog.hanschen.site/2016/12/10/robolectric.html" target="_blank" rel="external">Robolectric使用教程</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/Powermockito/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/Powermockito/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PowerMock"><a href="#PowerMock" class="headerlink" title="PowerMock"></a>PowerMock</h1><ul>
<li><a href="https://github.com/powermock/powermock" target="_blank" rel="external">GitHub</a></li>
<li><a href="http://powermock.github.io/" target="_blank" rel="external">官网</a></li>
</ul>
<h2 id="为什么要使用PowerMock"><a href="#为什么要使用PowerMock" class="headerlink" title="为什么要使用PowerMock"></a>为什么要使用PowerMock</h2><p>现如今比较流行的Mock工具如 jMock 、EasyMock 、Mockito等都有一个共同的缺点：不能mock静态、final、私有方法等。而PowerMock能够完美的弥补以上三个Mock工具的不足。</p>
<h2 id="PowerMock简介"><a href="#PowerMock简介" class="headerlink" title="PowerMock简介"></a>PowerMock简介</h2><p>PowerMock 也是一个单元测试模拟框架，它是在其它单元测试模拟框架的基础上做出的扩展。通过提供定制的类加载器以及一些字节码篡改技巧的应用，PowerMock 现了对静态方法、构造方法、私有方法以及 Final 方法的模拟支持，对静态初始化过程的移除等强大的功能。因为 PowerMock 在扩展功能时完全采用和被扩展的框架相同的 API, 熟悉 PowerMock 所支持的模拟框架的开发者会发现 PowerMock 非常容易上手。PowerMock 的目的就是在当前已经被大家所熟悉的接口上通过添加极少的方法和注释来实现额外的功能。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="comment">// PowerMock brings in the mockito dependency</span></div><div class="line">    testCompile <span class="string">'org.powermock:powermock-module-junit4:1.6.5'</span></div><div class="line">    testCompile <span class="string">'org.powermock:powermock-module-junit4-rule:1.6.5'</span></div><div class="line">    testCompile <span class="string">'org.powermock:powermock-api-mockito:1.6.5'</span></div><div class="line">    testCompile <span class="string">'org.powermock:powermock-classloading-xstream:1.6.5'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="注解："><a href="#注解：" class="headerlink" title="注解："></a>注解：</h3><ul>
<li>@RunWith</li>
<li>@PrepareForTest - 是声明需要进行mock的静态类</li>
<li>@PowerMockIgnore - 声明package路径，表示不使用PowerMockito来加载所声明的package路径的类。</li>
</ul>
<blockquote>
<p>注：如果你的测试用例里没有使用注解 <code>@PrepareForTest</code>，那么可以不用加注解 <code>@RunWith(PowerMockRunner.class)</code>，<br>反之亦然。当你需要使用PowerMock强大功能(Mock静态、final、私有方法等)的时候，就需要加注解 <code>@PrepareForTest</code>。</p>
</blockquote>
<p><strong>声明</strong></p>
<ul>
<li><p>使用注解方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(PowerMockRunner.class)</div><div class="line"><span class="meta">@PrepareForTest</span>(&#123;YourClassWithEgStaticMethod.class&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>注解和 Rule 的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@PrepareForTest</span>(&#123;YourClassWithEgStaticMethod.class&#125;)</div><div class="line"></div><div class="line"><span class="meta">@Rule</span></div><div class="line"><span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>声明多个静态类</strong></p>
<p><code>@PrepareForTest({Example1.class, Example2.class, ...})</code></p>
<h2 id="基本用法预览"><a href="#基本用法预览" class="headerlink" title="基本用法预览"></a>基本用法预览</h2><ul>
<li><p>PowerMockito.mock() </p>
<ul>
<li>创建 mock 对象  </li>
<li><code>PowerMockito.mock(File.class);</code></li>
</ul>
</li>
<li><p>PowerMockito.when().thenReturn() </p>
<ul>
<li>指定 mock 对象的某些方法的行为</li>
<li><code>PowerMockito.when(file.exists()).thenReturn(true);</code></li>
</ul>
</li>
<li><p>PowerMockito.whenNew().withArguments().thenReturn() </p>
<ul>
<li>模拟构造函数 </li>
<li><code>PowerMockito.whenNew(File.class).withArguments(directoryPath).thenReturn(directoryMock);</code></li>
</ul>
</li>
<li><p>PowerMockito.mockStatic(Utils.class)</p>
<ul>
<li>模拟静态</li>
<li><code>PowerMockito.mockStatic(CommonExample.class);</code></li>
</ul>
</li>
<li><p>PowerMockito.verifyNew().withArguments();</p>
<ul>
<li>验证指定构造函数是否被调用    </li>
<li><code>PowerMockito.verifyNew(File.class).withArguments(directoryPath);</code>   </li>
</ul>
</li>
<li><p>PowerMockito.verifyStatic();</p>
<ul>
<li>验证静态方法是否被调用</li>
<li><code>PowerMockito.verifyStatic();</code></li>
</ul>
</li>
<li><p>PowerMockito.verifyPrivate().invoke()</p>
<ul>
<li>验证私有方法是否被调用</li>
<li><code>verifyPrivate(commonExample).invoke(&quot;isExist&quot;);</code></li>
</ul>
</li>
</ul>
<h2 id="基本用法详解"><a href="#基本用法详解" class="headerlink" title="基本用法详解"></a>基本用法详解</h2><h3 id="1-普通Mock：Mock参数传递的对象"><a href="#1-普通Mock：Mock参数传递的对象" class="headerlink" title="1. 普通Mock：Mock参数传递的对象"></a>1. 普通Mock：Mock参数传递的对象</h3><blockquote>
<p>普通Mock不需要加 <code>@RunWith</code> 和 <code>@PrepareForTest</code> 注解</p>
</blockquote>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">callArgumentInstance</span><span class="params">(File file)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> file.exists();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallArgumentInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 创建出一个mock对象</span></div><div class="line">        File file = PowerMockito.mock(File.class);    </div><div class="line">        CommonExample commonExample = <span class="keyword">new</span> CommonExample();</div><div class="line">        <span class="comment">// 指定这个mock对象具体的行为</span></div><div class="line">        PowerMockito.when(file.exists()).thenReturn(<span class="keyword">true</span>);</div><div class="line">        <span class="comment">// 将mock对象作为参数传递个测试方法，执行测试方法</span></div><div class="line">        Assert.assertTrue(commonExample.callArgumentInstance(file));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-模拟构造方法"><a href="#2-模拟构造方法" class="headerlink" title="2. 模拟构造方法"></a>2. 模拟构造方法</h3><blockquote>
<p>需要添加注解</p>
<ul>
<li>@Rule</li>
<li>@PrepareForTest ,里面的类是需要mock的new对象代码所在的类</li>
</ul>
<p>可以很好的模拟构造函数,从而使被测代码中 new 操作返回的对象可以被随意定制，会很大程度的提高单元测试的效率</p>
</blockquote>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createDirectoryStructure</span><span class="params">(String directoryPath)</span> </span>&#123;</div><div class="line">        File directory = <span class="keyword">new</span> File(directoryPath);</div><div class="line">        <span class="keyword">if</span> (directory.exists()) &#123;</div><div class="line">            String msg = <span class="string">"\""</span> + directoryPath + <span class="string">"\" 已经存在."</span>;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(msg);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> directory.mkdirs();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@PrepareForTest</span>(CommonExample.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMockConstructorMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">final</span> String directoryPath = <span class="string">"seemygod"</span>;</div><div class="line">        <span class="comment">//创建File的模拟对象</span></div><div class="line">        File directoryMock = PowerMockito.mock(File.class);</div><div class="line"></div><div class="line">        <span class="comment">//在当前测试用例下,当出现new File("seemygod")时,就返回模拟对象</span></div><div class="line">        PowerMockito.whenNew(File.class).withArguments(directoryPath).thenReturn(directoryMock);</div><div class="line"></div><div class="line">        <span class="comment">//当调用模拟对象的exists时,返回false</span></div><div class="line">        PowerMockito.when(directoryMock.exists()).thenReturn(<span class="keyword">false</span>);</div><div class="line">        <span class="comment">//当调用模拟对象的mkdirs时,返回true</span></div><div class="line">        PowerMockito.when(directoryMock.mkdirs()).thenReturn(<span class="keyword">true</span>);</div><div class="line">        Assert.assertTrue(<span class="keyword">new</span> CommonExample().createDirectoryStructure(directoryPath));</div><div class="line">        <span class="comment">//验证new File(directoryPath);  是否被调用过</span></div><div class="line">        PowerMockito.verifyNew(File.class).withArguments(directoryPath);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-Mock-final方法"><a href="#3-Mock-final方法" class="headerlink" title="3. Mock final方法"></a>3. Mock final方法</h3><blockquote>
<p>需要添加注解</p>
<ul>
<li>@Rule</li>
<li>@PrepareForTest(ClassDependency.class)，注解里写的类是需要mock的final方法所在的类</li>
</ul>
</blockquote>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">callFinalMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@PrepareForTest</span>(CommonExample.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallFinalMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        CommonExample commonExample = PowerMockito.mock(CommonExample.class);</div><div class="line">        PowerMockito.when(commonExample.callFinalMethod()).thenReturn(<span class="keyword">true</span>);</div><div class="line">        Assert.assertTrue(commonExample.callFinalMethod());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="4-Mock-静态方法"><a href="#4-Mock-静态方法" class="headerlink" title="4. Mock 静态方法"></a>4. Mock 静态方法</h3><blockquote>
<p>需要添加注解</p>
<ul>
<li>@Rule</li>
<li>@PrepareForTest(ClassDependency.class)，注解里写的类是静态方法所在的类</li>
</ul>
</blockquote>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">callStaticMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> UUID.randomUUID().toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerMockSampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@PrepareForTest</span>(CommonExample.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallStaticMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        PowerMockito.mockStatic(CommonExample.class);</div><div class="line">        PowerMockito.when(CommonExample.callStaticMethod()).thenReturn(<span class="string">"FAKE UUID"</span>);</div><div class="line">        Assert.assertEquals(<span class="string">"FAKE UUID"</span>, CommonExample.callStaticMethod());</div><div class="line">        <span class="comment">//验证静态方法是否被调用</span></div><div class="line">        PowerMockito.verifyStatic();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5-Mock-私有方法"><a href="#5-Mock-私有方法" class="headerlink" title="5.Mock 私有方法"></a>5.Mock 私有方法</h3><blockquote>
<p>需要添加注解</p>
<ul>
<li>@Rule</li>
<li>@PrepareForTest(ClassDependency.class)，注解里写的类是私有方法所在的类</li>
</ul>
</blockquote>
<p>测试目标方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">callPrivateMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> isExist();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isExist</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerMockSampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="meta">@PrepareForTest</span>(CommonExample.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCallPrivateMethod</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        CommonExample commonExample = spy(<span class="keyword">new</span> CommonExample());</div><div class="line"></div><div class="line">        PowerMockito.when(commonExample.callPrivateMethod()).thenCallRealMethod();</div><div class="line">        PowerMockito.when(commonExample, <span class="string">"isExist"</span>).thenReturn(<span class="keyword">true</span>);</div><div class="line">        Assert.assertTrue(commonExample.callPrivateMethod());</div><div class="line">        verifyPrivate(commonExample).invoke(<span class="string">"isExist"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6-Mock-私有变量"><a href="#6-Mock-私有变量" class="headerlink" title="6. Mock 私有变量"></a>6. Mock 私有变量</h3><blockquote>
<p>不需要加注解@PrepareForTest和@RunWith，而是使用Whitebox来mock私有变量mState并注入你预设的变量值。</p>
</blockquote>
<p>测试目标方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonExample</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATE_NOT_READY = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATE_READY = <span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mState = STATE_NOT_READY;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doSomethingIfStateReady</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mState == STATE_READY) </div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">else</span>  </div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PowerMockSampleTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> PowerMockRule rule = <span class="keyword">new</span> PowerMockRule();</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPrivateProperty</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        CommonExample sample = <span class="keyword">new</span> CommonExample();</div><div class="line">        Whitebox.setInternalState(sample, <span class="string">"mState"</span>, <span class="number">1</span>);</div><div class="line">        Assert.assertTrue(sample.doSomethingIfStateReady());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="PowerMock简单实现原理"><a href="#PowerMock简单实现原理" class="headerlink" title="PowerMock简单实现原理"></a>PowerMock简单实现原理</h2><ol>
<li><p>当某个测试方法被注解 <code>@PrepareForTest</code> 标注以后，在运行测试用例时，会创建一个新的 <code>org.powermock.core.classloader.MockClassLoader</code> 实例，然后加载该测试用例使用到的类（系统类除外）。</p>
</li>
<li><p>PowerMock会根据你的mock要求，去修改写在注解 <code>@PrepareForTest</code> 里的class文件（当前测试类会自动加入注解中），以满足特殊的mock需求。例如：去除’final方法的final标识，在静态方法的最前面加入自己的虚拟实现等。</p>
</li>
<li><p>如果需要mock的是系统类的final方法和静态方法，PowerMock不会直接修改系统类的class文件，而是修改调用系统类的class文件，以满足mock需求。</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/NotePPT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/NotePPT/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>安装<br>npm install -g nodeppt</p>
<p>启动<br>nodeppt start -p <port></port></p>
<p>输出ppt</p>
<ul>
<li>在连接后面输入<code>?print=0</code></li>
<li><code>ctrl + P</code> 保存成 ptf</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://xrcx.github.io/2017/11/07/Mockito/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xrcx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="学无止境">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/07/Mockito/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:01+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要使用Mock工具"><a href="#为什么要使用Mock工具" class="headerlink" title="为什么要使用Mock工具"></a>为什么要使用Mock工具</h2><p>在做单元测试的时候，我们会发现我们要测试的方法会引用很多外部依赖的对象，比如：（发送邮件，网络通讯，远程服务, 文件系统等等）。 而我们没法控制这些外部依赖的对象，为了解决这个问题，我们就需要用到Mock工具来模拟这些外部依赖的对象，来完成单元测试。</p>
<h2 id="什么是Mock"><a href="#什么是Mock" class="headerlink" title="什么是Mock"></a>什么是Mock</h2><p>所谓的mock就是创建一个类的虚假的对象，在测试环境中，用来替换掉真实的对象，以达到两大目的：</p>
<ul>
<li>验证这个对象的某些方法的调用情况，调用了多少次，参数是什么等等</li>
<li>指定这个对象的某些方法的行为，返回特定的值，或者是执行特定的动作</li>
</ul>
<h2 id="Mock-测试框架-Mockito"><a href="#Mock-测试框架-Mockito" class="headerlink" title="Mock 测试框架 - Mockito"></a>Mock 测试框架 - <a href="http://site.mockito.org/" target="_blank" rel="external">Mockito</a></h2><p><a href="https://github.com/mockito/mockito" target="_blank" rel="external">GitHub</a><br>Mockito 是一个基于MIT协议的开源 Java 测试框架，它能够 Mock 对象、验证结果以及为测试用例打桩。</p>
<h3 id="Mockito-Android支持"><a href="#Mockito-Android支持" class="headerlink" title="Mockito Android支持"></a>Mockito Android支持</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">  testCompile <span class="string">"org.mockito:mockito-core:2.+"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="用法大纲"><a href="#用法大纲" class="headerlink" title="用法大纲"></a>用法大纲</h3><blockquote>
<ul>
<li>mock()/ @Mock：创建模拟</li>
<li>verify() ：验证Mock对象的方法是否被调用。  Mockito.verify(objectToVerify).methodToVerify(arguments)</li>
<li>when().thenReturn(“”)/when().thenThrow()，打桩,指定mock对象的某些方法的行为  Mockito.when(mockObject.targetMethod(args)).thenReturn(desiredReturnValue)</li>
<li>when().thenAnswer() - 为回调做测试桩 </li>
<li>anyInt() , anyLong() ,  anyDouble(),  anyObject(),  any(clazz)等等 ： 参数设置-任意的Int类型，任意的Long类型，任意的Double类型,任何对象，任何属于clazz的对象…等</li>
<li>times() ：调用Mock对象的方法次数</li>
<li>atLeastOnce()，atMost(count) ,  atLeast(count) ,  never() ：至少一次，最多次数，最少次数，从不</li>
<li>doNothing()/doAnswer()/doThrow() - 指定一个方法执行特定的动作   Mockito.doAnswer(desiredAnswer).when(mockObject).targetMethod(args)</li>
<li>InOrder - 按顺序验证</li>
<li>spy,部分模拟，doReturn(“foo”).when(spy).get(0)</li>
</ul>
</blockquote>
<h3 id="详细用法"><a href="#详细用法" class="headerlink" title="详细用法"></a>详细用法</h3><h4 id="mock-Mock-创建Mock对象"><a href="#mock-Mock-创建Mock对象" class="headerlink" title="mock()/ @Mock - 创建Mock对象"></a>mock()/ @Mock - 创建Mock对象</h4><ul>
<li><p>mock()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List mockedList = mock(List.class);</div></pre></td></tr></table></figure>
</li>
<li><p>@Mock注解创建,需要使用MockitoAnnotations.initMocks(this),进行注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Mock</span></div><div class="line">List mockedList;  </div><div class="line"></div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMock</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//初始化@Mock注解的对象 (进行注入)</span></div><div class="line">    MockitoAnnotations.initMocks(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>@Mock注解创建,使用MockitoJUnitRunner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(MockitoJUnitRunner.StrictStubs.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Mock</span></div><div class="line">    <span class="keyword">private</span> List list;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouldDoSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">        list.add(<span class="number">100</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>@Mock注解创建,使用MockitoRule</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//Creating new rule with recommended Strictness setting</span></div><div class="line">    <span class="meta">@Rule</span> <span class="keyword">public</span> MockitoRule rule = MockitoJUnit.rule().strictness(Strictness.STRICT_STUBS);</div><div class="line"></div><div class="line">    <span class="meta">@Mock</span></div><div class="line">    <span class="keyword">private</span> List list;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shouldDoSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">        list.add(<span class="number">100</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="verify-验证某些行为"><a href="#verify-验证某些行为" class="headerlink" title="verify() - 验证某些行为"></a>verify() - 验证某些行为</h4><blockquote>
<p>Mock对象将记住所有的操作，可以验证其行为</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用Mock对象</span></div><div class="line">mockedList.add(<span class="string">"one"</span>);</div><div class="line">mockedList.clear();</div><div class="line"></div><div class="line"><span class="comment">//验证函数的调用次数</span></div><div class="line">verify(mockedList).add(<span class="string">"one"</span>);</div><div class="line"><span class="comment">//verify(mockedList).add("two"); 无此操作，验证 failed</span></div><div class="line">verify(mockedList).clear();</div></pre></td></tr></table></figure>
<h4 id="when-thenReturn-when-thenThrow-打桩"><a href="#when-thenReturn-when-thenThrow-打桩" class="headerlink" title="when().thenReturn()/when().thenThrow() - 打桩"></a>when().thenReturn()/when().thenThrow() - 打桩</h4><blockquote>
<p>在创建出Mock对象后，默认返回值为null，故可做进行打桩，每当调用该打桩后的方法或变量后，让其返回相应的值。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//测试桩，在调用get(0)时返回"first"</span></div><div class="line">when(mockedList.get(<span class="number">0</span>)).thenReturn(<span class="string">"first"</span>);</div><div class="line"><span class="comment">//调用get(1)时抛出异常</span></div><div class="line">when(mockedList.get(<span class="number">1</span>)).thenThrow(<span class="keyword">new</span> RuntimeException());</div><div class="line"></div><div class="line"><span class="comment">//输出first</span></div><div class="line">System.out.println(mockedList.get(<span class="number">0</span>));</div><div class="line"><span class="comment">//抛出异常</span></div><div class="line"><span class="comment">//System.out.println(mockedList.get(1));</span></div><div class="line"><span class="comment">//因为get(999)没有打桩，因此输出null</span></div><div class="line">System.out.println(mockedList.get(<span class="number">999</span>));</div></pre></td></tr></table></figure>
<h5 id="为连续的调用做测试桩-Stub"><a href="#为连续的调用做测试桩-Stub" class="headerlink" title="为连续的调用做测试桩(Stub)"></a>为连续的调用做测试桩(Stub)</h5><p>通过这个注解，可实现自动注入mock对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*when(mockedList.get(anyInt()))</span></div><div class="line">            .thenThrow(new RuntimeException())</div><div class="line">            .thenReturn("foo");*/</div><div class="line"></div><div class="line"><span class="comment">//第一次调用:抛出运行时异常</span></div><div class="line">System.out.println(mockedList.get(<span class="number">0</span>));</div><div class="line"><span class="comment">//第二次调用:输出"foo"</span></div><div class="line">System.out.println(mockedList.get(<span class="number">1</span>));</div><div class="line"><span class="comment">//第三次调用:也是输出"foo"</span></div><div class="line">System.out.println(mockedList.get(<span class="number">2</span>));</div></pre></td></tr></table></figure>
<p>替代方案，短版连续桩<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">when(mockedList.get(anyInt()))</div><div class="line">        .thenReturn(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>);</div></pre></td></tr></table></figure></p>
<h4 id="when-thenAnswer-为回调做测试桩"><a href="#when-thenAnswer-为回调做测试桩" class="headerlink" title="when().thenAnswer() - 为回调做测试桩"></a>when().thenAnswer() - 为回调做测试桩</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">when(mockedList.get(anyInt())).thenAnswer(<span class="keyword">new</span> Answer&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        <span class="comment">//获取函数调用的参数</span></div><div class="line">        Object[] args = invocation.getArguments();</div><div class="line">        <span class="comment">//获得Mock对象本身</span></div><div class="line">        Object mock = invocation.getMock();</div><div class="line">        <span class="keyword">return</span> <span class="string">"answer===&gt;"</span> + mock.toString();</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">System.out.println(mockedList.get(<span class="number">50</span>));</div><div class="line"></div><div class="line"><span class="comment">//doReturn(),doThrow(),doAnswer(),doNothing(),noCallRealMethod()</span></div></pre></td></tr></table></figure>
<h4 id="anyInt-anyString-参数匹配器"><a href="#anyInt-anyString-参数匹配器" class="headerlink" title="anyInt()/anyString() - 参数匹配器"></a>anyInt()/anyString() - 参数匹配器</h4><blockquote>
<p>让打桩更具灵活性，比如anyInt()将匹配所有的int值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用内置的anyInt()参数匹配器，当调用get(int)时都返回"element"</span></div><div class="line">when(mockedList.get(anyInt())).thenReturn(<span class="string">"element"</span>);</div><div class="line"><span class="comment">//使用自定义的参数器(在inValid()函数中返回你自己的匹配器实现)</span></div><div class="line"><span class="comment">//when(mockedList.get(isValid())).thenReturn("element");</span></div><div class="line"></div><div class="line"><span class="comment">//输出element</span></div><div class="line">System.out.println(mockedList.get(<span class="number">999</span>));</div><div class="line"><span class="comment">//也可以验证匹配器</span></div><div class="line"><span class="comment">//verify(mockedList).get(anyInt());</span></div></pre></td></tr></table></figure>
<h4 id="验证函数的确切调用次数、最少调用、从未调用"><a href="#验证函数的确切调用次数、最少调用、从未调用" class="headerlink" title="验证函数的确切调用次数、最少调用、从未调用"></a>验证函数的确切调用次数、最少调用、从未调用</h4><ul>
<li>times(x) ,几次</li>
<li>atLeastOnce()，至少一次</li>
<li>atLeast(x)，至少x次</li>
<li>atMost(x)，最多x次</li>
<li>never()，从不<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">mockedList.add(<span class="string">"once"</span>);</div><div class="line"></div><div class="line">mockedList.add(<span class="string">"twice"</span>);</div><div class="line">mockedList.add(<span class="string">"twice"</span>);</div><div class="line"></div><div class="line">mockedList.add(<span class="string">"three times"</span>);</div><div class="line">mockedList.add(<span class="string">"three times"</span>);</div><div class="line">mockedList.add(<span class="string">"three times"</span>);</div><div class="line"></div><div class="line"><span class="comment">//下面两个的验证结果一样，因为verify默认验证的就是times(1)</span></div><div class="line">verify(mockedList).add(<span class="string">"once"</span>);</div><div class="line">verify(mockedList, times(<span class="number">1</span>)).add(<span class="string">"once"</span>);</div><div class="line"></div><div class="line"><span class="comment">//验证具体的执行次数</span></div><div class="line">verify(mockedList, times(<span class="number">2</span>)).add(<span class="string">"twice"</span>);</div><div class="line">verify(mockedList, times(<span class="number">3</span>)).add(<span class="string">"three times"</span>);</div><div class="line"></div><div class="line"><span class="comment">//使用never验证，never相当于time(0)</span></div><div class="line">verify(mockedList, never()).add(<span class="string">"never happened"</span>);</div><div class="line"></div><div class="line"><span class="comment">//使用atLeast()/atMost</span></div><div class="line">verify(mockedList, atLeastOnce()).add(<span class="string">"three times"</span>);</div><div class="line">verify(mockedList, atLeast(<span class="number">2</span>)).add(<span class="string">"twice"</span>);</div><div class="line">verify(mockedList, atMost(<span class="number">5</span>)).add(<span class="string">"three times"</span>);</div><div class="line"></div><div class="line">List mockTwo = mock(List.class);  </div><div class="line"><span class="comment">//验证Mock对象没有交互过</span></div><div class="line"><span class="comment">//verifyZeroInteractions(mockedList); //mockedList已交互过</span></div><div class="line">verifyZeroInteractions(mockTwo); <span class="comment">//mockTwo没有交互过</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="doNothing-doAnswer-doThrow-doReturn-doCallRealMethod-指定一个方法执行特定的动作"><a href="#doNothing-doAnswer-doThrow-doReturn-doCallRealMethod-指定一个方法执行特定的动作" class="headerlink" title="doNothing()/doAnswer()/doThrow()/doReturn()/doCallRealMethod() - 指定一个方法执行特定的动作"></a>doNothing()/doAnswer()/doThrow()/doReturn()/doCallRealMethod() - 指定一个方法执行特定的动作</h4><blockquote>
<p>这个功能一般是用在目标的方法是void类型的时候。</p>
</blockquote>
<ul>
<li>返回空的方法上</li>
<li>Spy 对象的方法上</li>
<li>对同一个方法多次打桩，以改变在测试中间的模拟的行为。<h5 id="doAnswer"><a href="#doAnswer" class="headerlink" title="doAnswer()"></a>doAnswer()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loginCallbackVersion</span><span class="params">(String username, String password)</span> </span>&#123; </div><div class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span> || username.length() == <span class="number">0</span>) <span class="keyword">return</span>; </div><div class="line">    <span class="comment">//假设我们对密码强度有一定要求，使用一个专门的validator来验证密码的有效性 </span></div><div class="line">    <span class="keyword">if</span> (mPasswordValidator.verifyPassword(password)) <span class="keyword">return</span>; </div><div class="line">    <span class="comment">//login的结果将通过callback传递回来。</span></div><div class="line">     mUserManager.performLogin(username, password, <span class="keyword">new</span>  NetworkCallback() &#123; </div><div class="line">          <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Object data)</span> </span>&#123; </div><div class="line">              <span class="comment">//update view with data</span></div><div class="line">           &#125;</div><div class="line">           <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(<span class="keyword">int</span> code, String msg)</span> </span>&#123;</div><div class="line">             <span class="comment">//show error msg</span></div><div class="line">           &#125;</div><div class="line">     &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在测试环境下，我们并不想依赖mUserManager.performLogin的真实逻辑，而是让mUserManager直接调用传入的NetworkCallback的onSuccess或onFailure方法。这种指定mock对象执行特定的动作的写法如下：<br><code>Mockito.doAnswer(desiredAnswer).when(mockObject).targetMethod(args)</code>,传给doAnswer()的是一个Answer对象，我们想要执行什么样的动作，就在这里面实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Mockito.doAnswer(<span class="keyword">new</span> Answer() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123; </div><div class="line">        <span class="comment">//这里可以获得传给performLogin的参数 </span></div><div class="line">        Object[] arguments = invocation.getArguments(); <span class="comment">//callback是第三个参数</span></div><div class="line">        NetworkCallback callback = (NetworkCallback) arguments[<span class="number">2</span>]; </div><div class="line">        callback.onFailure(<span class="number">500</span>, <span class="string">"Server error"</span>); </div><div class="line">        <span class="keyword">return</span> <span class="number">500</span>; </div><div class="line">    &#125;</div><div class="line">&#125;).when(mockUserManager).performLogin(anyString(), anyString(),any(NetworkCallback.class));</div></pre></td></tr></table></figure>
<h5 id="doThrow"><a href="#doThrow" class="headerlink" title="doThrow()"></a>doThrow()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">doThrow(<span class="keyword">new</span> RuntimeException()).when(mockedList).clear();</div><div class="line"></div><div class="line"><span class="comment">//following throws RuntimeException:</span></div><div class="line">mockedList.clear();</div></pre></td></tr></table></figure>
<h4 id="InOrder-按顺序验证"><a href="#InOrder-按顺序验证" class="headerlink" title="InOrder - 按顺序验证"></a>InOrder - 按顺序验证</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Multiple mocks that must be used in a particular order</span></div><div class="line"> List firstMock = mock(List.class);</div><div class="line"> List secondMock = mock(List.class);</div><div class="line"></div><div class="line"> <span class="comment">//using mocks</span></div><div class="line"> firstMock.add(<span class="string">"was called first"</span>);</div><div class="line"> secondMock.add(<span class="string">"was called second"</span>);</div><div class="line"></div><div class="line"> <span class="comment">//create inOrder object passing any mocks that need to be verified in order</span></div><div class="line"> InOrder inOrder = inOrder(firstMock, secondMock);</div><div class="line"></div><div class="line"> <span class="comment">//following will make sure that firstMock was called before secondMock</span></div><div class="line"> inOrder.verify(firstMock).add(<span class="string">"was called first"</span>);</div><div class="line"> inOrder.verify(secondMock).add(<span class="string">"was called second"</span>);</div></pre></td></tr></table></figure>
<h4 id="Spy"><a href="#Spy" class="headerlink" title="Spy"></a>Spy</h4><blockquote>
<p>Mock对象只能调用stubbed方法，没有调用不了它真实的方法。<br>但Mockito可以监视一个真实的对象，这时对它进行方法调用时它将调用真实的方法，同时也可以stubbing这个对象的方法让它返回我们的期望值。<br>另外不论是否是真实的方法调用都可以进行verify验证。和创建mock对象一样，对于final类、匿名类和Java的基本类型是无法进行spy的。</p>
<h5 id="监视对象"><a href="#监视对象" class="headerlink" title="监视对象"></a>监视对象</h5><p>监视一个对象需要调用spy(T object)方法，如：List spy = spy(new LinkedList());那么spy变量就在监视LinkedList实例。<br>用<code>doReturn|Answer|Throw()</code>，stubbing Spy对象的方法 ，最好不用 <code>when(Object)</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">List list = <span class="keyword">new</span> LinkedList();</div><div class="line"></div><div class="line"><span class="comment">//监控一个真实的对象</span></div><div class="line">List spy = spy(list);</div><div class="line"><span class="comment">//可以为某些函数打桩</span></div><div class="line">when(spy.size()).thenReturn(<span class="number">100</span>);</div><div class="line"></div><div class="line"><span class="comment">//在监控真实对象上使用when会报错，可以使用onReturn、Answer、Throw()函数族来进行打桩</span></div><div class="line"><span class="comment">//不能:因为当调用spy.get(0)时会调用真实对象的get(0)函数，此时会发生IndexOutOfBoundsException异常，因为真实List对象是空的</span></div><div class="line">when(spy.get(<span class="number">0</span>)).thenReturn(<span class="string">"foo"</span>);</div><div class="line"><span class="comment">// 正确用法</span></div><div class="line">doReturn(<span class="string">"foo"</span>).when(spy).get(<span class="number">0</span>);</div><div class="line"></div><div class="line">System.out.println(spy.get(<span class="number">0</span>));</div><div class="line"></div><div class="line"><span class="comment">//Mockito并不会为真实对象代理函数(Method)调用，实际上它会复制真实对象。</span></div><div class="line"><span class="comment">//当你在监控一个真实对象时，你想为这个真实对象的函数做测试桩，那么就是在自找麻烦。</span></div><div class="line"></div><div class="line"><span class="comment">//通过spy对象调用真实对象的函数</span></div><div class="line">spy.add(<span class="string">"one"</span>);</div><div class="line">spy.add(<span class="string">"two"</span>);</div><div class="line"></div><div class="line">System.out.println(spy.get(<span class="number">0</span>));</div><div class="line">System.out.println(spy.size());</div><div class="line"></div><div class="line"><span class="comment">//交互验证</span></div><div class="line">verify(spy).add(<span class="string">"one"</span>);</div><div class="line">verify(spy).add(<span class="string">"two"</span>);</div></pre></td></tr></table></figure>
<h5 id="InjectMocks"><a href="#InjectMocks" class="headerlink" title="@InjectMocks"></a>@InjectMocks</h5><blockquote>
<p>mock对象自动注入，注意：使用了@Mock注解，必须使用@RunWith(MockitoJUnitRunner.class) 或 MockitoAnnotations.initMocks(this) 或 MockitoRule  进行mocks的初始化和注入。</p>
</blockquote>
<p><strong>区别</strong></p>
<ul>
<li>@Mock: 创建一个Mock.</li>
<li>@InjectMocks: 创建一个实例，其余用@Mock（或@Spy）注解创建的mock将被注入到用该实例中。</li>
</ul>
<p>测试目标代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">LoginPresenter</span><span class="params">(UserManager userManager, PasswordValidator passwordValidator)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.mUserManager = userManager;</div><div class="line">    <span class="keyword">this</span>.mPasswordValidator = passwordValidator;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试用例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginPresenterTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> MockitoRule mockitoRule = MockitoJUnit.rule();</div><div class="line"></div><div class="line">    <span class="meta">@Mock</span></div><div class="line">    UserManager mockUserManager;</div><div class="line">    <span class="meta">@Mock</span></div><div class="line">    PasswordValidator mockValidator;</div><div class="line"></div><div class="line">    <span class="meta">@InjectMocks</span></div><div class="line">    LoginPresenter loginPresenter;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLogin</span><span class="params">()</span> </span>&#123;</div><div class="line">        Mockito.when(mockValidator.verifyPassword(<span class="string">"xiaochuang is handsome"</span>)).thenReturn(<span class="keyword">true</span>);</div><div class="line">        loginPresenter.login(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang is handsome"</span>);</div><div class="line"></div><div class="line">        verify(mockUserManager).performLogin(<span class="string">"xiaochuang"</span>, <span class="string">"xiaochuang is handsome"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>LoginPresenter 被 @InjectMocks 修饰，他的构造方法所需要的两个参数正好这个测试类里面有这样的field被@Mock修饰过，所以 mockUserManager 和 mockValidator就构造出了 LoginPresenter，这种叫做 <code>Constructor Injection</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginPresenter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> UserManager mUserManager;</div><div class="line">    <span class="keyword">private</span> PasswordValidator mPasswordValidator;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginPresenter</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果 LoginPresenter 只有一个无参构造函数，Mockito依然会将LoginPresenter里面的mUserManager和mPasswordValidator初始化为LoginPresenterTest里面的两个mock对象，mockUserManager和mockValidator。这个效果跟LoginPresenter有两个构造参数是一样的,这个叫 <code>Field Injection</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginPresenter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> UserManager mUserManager;</div><div class="line">    <span class="keyword">private</span> PasswordValidator mPasswordValidator;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginPresenter</span><span class="params">(UserManager userManager)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mUserManager = userManager;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>如果LoginPresenter只有一个UserManager的构造方法,只有mUserManager会被初始化为mockUserManager, 而mPasswordValidator是不会初始化为mockValidator的</li>
</ul>
<blockquote>
<p>此外还有<code>Property Setter Injection</code>，也就是通过setter方法，自动的初始化@InjectMocks对象</p>
<p>这三种injection的优先级顺序分别为： Constructor Injection &gt; Property Setter Injection &gt; Field Injection。</p>
<p>所以不推荐使用 <code>@InjectMocks</code>,因为很难弄清楚到底会通过哪种方式inject</p>
</blockquote>
<h4 id="为下一步的断言捕获参数"><a href="#为下一步的断言捕获参数" class="headerlink" title="为下一步的断言捕获参数"></a>为下一步的断言捕获参数</h4><blockquote>
<p>ArgumentCaptor与自定义的参数匹配器相关<br>这两种技术都能用于检测外出传递到Mock对象的参数<br>rgumentCaptor更适合以下情况:</p>
<ol>
<li>自定义不能被重用的参数匹配器 </li>
<li>仅需要断言参数值</li>
</ol>
</blockquote>
<ul>
<li><p>ArgumentCaptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在某些场景中，不光要对方法的返回值和调用进行验证，同时需要验证一系列交互后所传入方法的参数。那么我们可以用参数捕获器来捕获传入方法的参数进行验证，看它是否符合我们的要求。</span></div><div class="line">mockedList.add(<span class="string">"Haha"</span>);</div><div class="line">ArgumentCaptor argument = ArgumentCaptor.forClass(String.class);</div><div class="line">verify(mockedList).add(argument.capture());</div><div class="line">assertEquals(<span class="string">"Haha"</span>, argument.getValue());</div></pre></td></tr></table></figure>
</li>
<li><p>@Captor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoTests</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Rule</span></div><div class="line">    <span class="keyword">public</span> MockitoRule rule = MockitoJUnit.rule();</div><div class="line"></div><div class="line">    <span class="meta">@Captor</span></div><div class="line">    <span class="keyword">private</span> ArgumentCaptor&lt;List&lt;String&gt;&gt; captor;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">shouldContainCertainListItem</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;String&gt; asList = Arrays.asList(<span class="string">"someElement_test"</span>, <span class="string">"someElement"</span>);</div><div class="line">        <span class="keyword">final</span> List&lt;String&gt; mockedList = mock(List.class);</div><div class="line">        mockedList.addAll(asList);</div><div class="line"></div><div class="line">        verify(mockedList).addAll(captor.capture());</div><div class="line">        <span class="keyword">final</span> List&lt;String&gt; capturedArgument = captor.getValue();</div><div class="line">        assertThat(capturedArgument, hasItem(<span class="string">"someElement"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="xrcx" />
          <p class="site-author-name" itemprop="name">xrcx</p>
           
              <p class="site-description motion-element" itemprop="description">做自己爱做的事，爱自己在做的事！贵在坚持~</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xrcx</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
